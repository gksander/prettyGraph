"use strict";$(function(){PG.fillInputs(),PG.registerListeners(),PG.initBoard(),PG.pullStoredElements(),$("#saveConstruction").on("click",function(){PG.saveVars()}),$(window).on("keydown",function(event){if(event.ctrlKey||event.metaKey)switch(String.fromCharCode(event.which).toLowerCase()){case"s":event.preventDefault(),PG.saveVars(),console.log("saved")}}),$(".panel-large-head").on("click",function(){$(this).closest(".panel-large").find(".panel-large-body").slideToggle()})});var PG={tmp:{},vars:localStorage.PGvars?JSON.parse(localStorage.PGvars):{boardWidth:350,boardHeight:350,bounds:[-5,5,-5,5],xLabel:"$x$",yLabel:"$y$",ticksDistance:[2,2],minorTicks:[1,1],globalFontSize:20},board:"",els:localStorage.PGels?JSON.parse(localStorage.PGels):{}};PG.fillInputs=function(){$("#graphWidth").val(PG.vars.boardWidth),$("#graphHeight").val(PG.vars.boardHeight),$("#graphxMin").val(PG.vars.bounds[0]),$("#graphxMax").val(PG.vars.bounds[1]),$("#graphyMin").val(PG.vars.bounds[2]),$("#graphyMax").val(PG.vars.bounds[3]),$("#graphXTicksDistance").val(PG.vars.ticksDistance[0]),$("#graphYTicksDistance").val(PG.vars.ticksDistance[1]),$("#graphxLabel").val(PG.vars.xLabel),$("#graphyLabel").val(PG.vars.yLabel),$("#verticalyLabel").attr("checked",PG.vars.yLabelVertical),$("#graphFontSize").val(PG.vars.globalFontSize)},PG.registerListeners=function(){$(".graphSize").on("change",PG.changeGraphSize),$(".graphBounds").on("change",PG.changeGraphBounds),$(".ticksDistance").on("change",PG.changeTicksDistance),$(".axisLabel").on("change",PG.changeAxesLabels),$("#verticalyLabel").on("change",PG.changeyLabelOrient),$("#graphFontSize").on("change",PG.changeGlobalFontSize),$("#newElementType").on("change",PG.addNewElement),$(document).on("click",".deleteItem",function(){var id=$(this).closest("li.elementItem").attr("id");PG.removeElement(id)})},PG.changeGraphSize=function(){PG.vars.boardWidth=parseFloat($("#graphWidth").val()),PG.vars.boardHeight=parseFloat($("#graphHeight").val());try{$("#box").css({width:PG.vars.boardWidth,height:PG.vars.boardHeight}),PG.board.resizeContainer(PG.vars.boardWidth,PG.vars.boardHeight)}catch(err){console.log(err)}},PG.changeGraphBounds=function(){var xmin=parseFloat($("#graphxMin").val()),xmax=parseFloat($("#graphxMax").val()),ymin=parseFloat($("#graphyMin").val()),ymax=parseFloat($("#graphyMax").val());PG.vars.bounds=[xmin,xmax,ymin,ymax];try{PG.board.setBoundingBox([xmin,ymax,xmax,ymin],!1)}catch(err){console.log(err)}},PG.changeTicksDistance=function(){var xTicksDistance=parseFloat($("#graphXTicksDistance").val()),yTicksDistance=parseFloat($("#graphYTicksDistance").val());PG.vars.ticksDistance=[xTicksDistance,yTicksDistance];try{PG.tmp.xAxisTicks.setAttribute({ticksDistance:PG.vars.ticksDistance[0]}),PG.tmp.yAxisTicks.setAttribute({ticksDistance:PG.vars.ticksDistance[1]})}catch(err){console.log(err)}},PG.changeAxesLabels=function(){var xLabel=$("#graphxLabel").val(),yLabel=$("#graphyLabel").val();PG.vars.xLabel=xLabel,PG.vars.yLabel=yLabel;try{PG.tmp.xaxis.setAttribute({name:PG.vars.xLabel}),PG.tmp.yaxis.setAttribute({name:PG.vars.yLabel})}catch(err){console.log(err)}},PG.changeyLabelOrient=function(){PG.vars.yLabelVertical=$("#verticalyLabel").is(":checked"),PG.saveVars(),location.reload()},PG.changeGlobalFontSize=function(){PG.vars.globalFontSize=parseFloat($("#graphFontSize").val()),PG.saveVars(),location.reload()},PG.saveVars=function(){localStorage.PGvars=JSON.stringify(PG.vars),localStorage.PGels=JSON.stringify(PG.els)},PG.dropVars=function(){localStorage.PGvars="",localStorage.PGels=""},PG.pullStoredElements=function(){for(var i in PG.els){PG.els[i].type;PG.buildElementHtml(PG.els[i]),PG.buildBoardElement(PG.els[i])}},PG.addNewElement=function(){var type=$("#newElementType").val();if(0==type)return!1;$("#newElementType").val(0);var id=Math.random().toString(36).substring(2,8);switch(PG.els[id]={id:id,type:type},type){case"functiongraph":PG.els[id].funcdef="x^2",PG.els[id].lowerBound="",PG.els[id].upperBound="",PG.els[id].strokeWidth=3,PG.els[id].strokeColor="black",PG.els[id].dash=0;break;case"point":PG.els[id].x=1,PG.els[id].y=2,PG.els[id].size=3,PG.els[id].name="",PG.els[id].color="black";break;case"line":PG.els[id].startX=0,PG.els[id].startY=0,PG.els[id].endX=2,PG.els[id].endY=2,PG.els[id].strokeWidth=3,PG.els[id].strokeColor="blue",PG.els[id].dash=0,PG.els[id].arrow=0,PG.els[id].ends=0;break;case"text":PG.els[id].x=1,PG.els[id].y=1,PG.els[id].text="`Delta x`",PG.els[id].fontSize=PG.vars.globalFontSize,PG.els[id].anchorX=0,PG.els[id].anchorY=0,PG.els[id].color="blue";break;case"circle":PG.els[id].x=1,PG.els[id].y=1,PG.els[id].r=2,PG.els[id].strokeWidth=3,PG.els[id].strokeColor="black",PG.els[id].fillColor="white",PG.els[id].fillOpacity=0,PG.els[id].dash=0}PG.buildElementHtml(PG.els[id]),PG.buildBoardElement(PG.els[id])},PG.removeElement=function(id){PG.board.removeObject(PG.tmp[id]),delete PG.tmp[id],delete PG.els[id],$("#"+id).remove()},PG.buildElementHtml=function(ops){switch(ops.type){case"functiongraph":var os="\n                <li class='elementItem' id='"+(ops.id?ops.id:"needid")+"'>\n                    <p class='elementItemTitle'><span class='deleteItem'>&times;</span> Function Graph</p>\n                    <ul>\n                        <li>Func. Definition: <input type='text' class='element_funcDef' value='"+ops.funcdef+"' size='10'></li>\n                        <li>Lower Bound: <input type='text' class='element_funcLB' value='"+ops.lowerBound+"' size=5/></li>\n                        <li>Upper Bound: <input type='text' class='element_funcUB' value='"+ops.upperBound+"' size=5/></li>\n                        <li>"+PG.buildAestheticComponent("strokeWidth",{strokeWidth:ops.strokeWidth})+"</li>\n                        <li>"+PG.buildAestheticComponent("strokeColor",{strokeColor:ops.strokeColor})+"</li>\n                        <li>"+PG.buildAestheticComponent("dash",{dash:ops.dash})+"</li>\n                    </ul>\n                </li>\n            ";break;case"point":var os="\n                <li class='elementItem' id='"+(ops.id?ops.id:"needid")+"'>\n                    <p class='elementItemTitle'><span class='deleteItem'>&times;</span> Point</p>\n                    <ul>\n                        <li>Location: (<input type='text' class='element_pointX' size=8 value='"+ops.x+"'>,\n                        <input type='text' class='element_pointY' size=8 value='"+ops.y+"'>)</li>\n                        <li>"+PG.buildAestheticComponent("size",{size:ops.size})+"</li>\n                        <li>"+PG.buildAestheticComponent("name",{name:ops.name})+"</li>\n                        <li>"+PG.buildAestheticComponent("color",{color:ops.color})+"</li>\n                    </ul>\n                </li>\n            ";break;case"line":var os="\n                <li class='elementItem' id='"+(ops.id?ops.id:"needid")+"'>\n                    <p class='elementItemTitle'><span class='deleteItem'>&times;</span> Line (Segment)</p>\n                    <ul>\n                        <li>Start at: (\n                            <input type='text' class='element_segmentStartX element_segmentCoords' size=8 value='"+ops.startX+"'>,\n                            <input type='text' class='element_segmentStartY element_segmentCoords' size=8 value='"+ops.startY+"'>\n                        )</li>\n                        <li>End at: (\n                            <input type='text' class='element_segmentEndX element_segmentCoords' size=8 value='"+ops.endX+"'>,\n                            <input type='text' class='element_segmentEndY element_segmentCoords' size=8 value='"+ops.endY+"'>\n                        )</li>\n                        <li>"+PG.buildAestheticComponent("strokeWidth",{strokeWidth:ops.strokeWidth})+"</li>\n                        <li>"+PG.buildAestheticComponent("strokeColor",{strokeColor:ops.strokeColor})+"</li>\n                        <li>"+PG.buildAestheticComponent("dash",{dash:ops.dash})+"</li>\n                        <li>"+PG.buildAestheticComponent("arrow",{arrow:ops.arrow})+"</li>\n                        <li>"+PG.buildAestheticComponent("end",{arrow:ops.end})+"</li>\n                    </ul>\n                </li>\n            ";break;case"text":var os="\n                <li class='elementItem' id='"+(ops.id?ops.id:"needid")+"'>\n                    <p class='elementItemTitle'><span class='deleteItem'>&times;</span> Text</p>\n                    <ul>\n                        <li>Text: <input type='text' class='element_text' size=15 value='"+ops.text+"'/></li>\n                        <li>Location: (\n                            <input type='text' class='element_textX' size=8 value='"+ops.x+"'>,\n                            <input type='text' class='element_textY' size=8 value='"+ops.y+"'>\n                        )</li>\n                        <li>"+PG.buildAestheticComponent("fontSize",{fontSize:ops.fontSize})+"</li>\n                        <li>"+PG.buildAestheticComponent("color",{color:ops.color})+"</li>\n                    </ul>\n                </li>\n            ";break;case"circle":var os="\n                <li class='elementItem' id='"+(ops.id?ops.id:"needid")+"'>\n                    <p class='elementItemTitle'><span class='deleteItem'>&times;</span> Circle</p>\n                    <ul>\n                        <li>Center: (\n                            <input type='text' class='element_circleX' size=8 value='"+ops.x+"'>,\n                            <input type='text' class='element_circleY' size=8 value='"+ops.y+"'>\n                        )</li>\n                        <li>Radius: <input type='text' class='element_circleR' size='8' value='"+ops.r+"'/></li>\n                        <li>"+PG.buildAestheticComponent("strokeWidth",{strokeWidth:ops.strokeWidth})+"</li>\n                        <li>"+PG.buildAestheticComponent("strokeColor",{strokeColor:ops.strokeColor})+"</li>\n                        <li>"+PG.buildAestheticComponent("fillColor",{fillColor:ops.fillColor})+"</li>\n                        <li>"+PG.buildAestheticComponent("fillOpacity",{fillOpacity:ops.fillOpacity})+"</li>\n                        <li>"+PG.buildAestheticComponent("dash",{dash:ops.dash})+"</li>\n                    </ul>\n                </li>\n            "}$("ul#elementList").append(os)},PG.buildBoardElement=function(ops){var id=ops.id;switch(ops.type){case"functiongraph":var ats={fixed:!0,highlight:!1,strokeWidth:ops.strokeWidth?ops.strokeWidth:3,strokeColor:ops.strokeColor?ops.strokeColor:"black",dash:ops.dash?ops.dash:0};PG.tmp[id]=PG.board.create("functiongraph",[function(x){return math.eval(ops.funcdef,{x:x})},ops.lowerBound?math.eval(ops.lowerBound):null,ops.upperBound?math.eval(ops.upperBound):null],ats);break;case"point":PG.tmp[ops.id]=PG.board.create("point",[math.eval(PG.els[id].x),math.eval(PG.els[id].y)],{fixed:!0,name:ops.name?ops.name:"",highlight:!1,color:ops.color?ops.color:"black",showInfobox:!1,size:ops.size?ops.size:3});break;case"line":PG.tmp[id]=PG.board.create("line",[[math.eval(ops.startX),math.eval(ops.startY)],[math.eval(ops.endX),math.eval(ops.endY)]],{fixed:!0,highlight:!1,strokeWidth:ops.strokeWidth?ops.strokeWidth:3,strokeColor:ops.strokeColor?ops.strokeColor:"black",dash:ops.dash?ops.dash:0,straightFirst:2==ops.end||3==ops.end,straightLast:1==ops.end||3==ops.end,firstArrow:2==ops.arrow||3==ops.arrow,lastArrow:1==ops.arrow||3==ops.arrow});break;case"text":PG.tmp[id]=PG.board.create("text",[math.eval(ops.x),math.eval(ops.y),function(){return ops.text}],{highlight:!1,anchorX:ops.anchorX==-1?"right":0==ops.anchorX?"middle":"left",anchorY:ops.anchorY==-1?"top":0==ops.anchorY?"middle":"bottom",fontSize:ops.fontSize,color:ops.color,useMathJax:!0});break;case"circle":PG.tmp[id]=PG.board.create("circle",[[math.eval(ops.x),math.eval(ops.y)],math.eval(ops.r)],{fixed:!0,highlight:!1,strokeWidth:ops.strokeWidth,strokeColor:ops.strokeColor,fillColor:ops.fillColor,fillOpacity:ops.fillOpacity,dash:ops.dash})}},PG.buildAestheticComponent=function(type,ops){switch(type){case"size":return"\n                Size: <input class='element_sizeRange' type='range' min='1' max='9' step='1' value='"+(ops.size?ops.size:3)+"'>\n            ";case"name":return"\n                Name: <input class='element_nameInput' type='text' size=9 value='"+(ops.name?ops.name:"")+"' />\n            ";case"color":return"\n                Color: <input class='element_colorInput' type='text' size=9 value='"+(ops.color?ops.color:"")+"'/>\n            ";case"strokeColor":return"\n                Stroke Color: <input class='element_strokeColorInput' type='text' size=9 value='"+(ops.strokeColor?ops.strokeColor:"")+"'/>\n            ";case"fillColor":return"\n                Fill Color: <input class='element_fillColorInput' type='text' size=9 value='"+(ops.fillColor?ops.fillColor:"")+"'/>\n            ";case"fillOpacity":return"\n                Fill Opacity: <input class='element_fillOpacity' type='range' min='0' max='1' step='0.01' value='"+(ops.fillOpacity?ops.fillOpacity:0)+"' />\n            ";case"strokeWidth":return"\n                Stroke Width: <input class='element_strokeWidth' type='range' min='1' max='7' step='1' value='"+(ops.strokeWidth?ops.strokeWidth:3)+"'/>\n            ";case"dash":return"\n                Dash: <input class='element_dash' type='range' min='0' max='6' step='1' value='"+(ops.dash?ops.dash:0)+"'/>\n            ";case"arrow":return"\n                Arrow: <input class='element_arrow' type='range' min='0' max='3' step='1' value='"+(ops.arrow?ops.arrow:0)+"'/>\n            ";case"end":return"\n                Ending: <input class='element_end' type='range' min='0' max='3' step='1' value='"+(ops.end?ops.end:0)+"'/>\n            ";case"fontSize":return"\n                Font Size: <input class='element_fontSize' type='text' size='8' value='"+(ops.fontSize?ops.fontSize:18)+"'/>\n            "}},$(function(){$("#elementList").on("change",".element_pointX, .element_pointY",function(){var id=$(this).closest("li.elementItem").attr("id"),x=$("li#"+id).find(".element_pointX").val(),y=$("li#"+id).find(".element_pointY").val();PG.els[id].x=x,PG.els[id].y=y;try{x=math.eval(x),y=math.eval(y)}catch(err){x=0,y=0}PG.tmp[id].setPosition(JXG.COORDS_BY_USER,[x,y]),PG.board.update()}),$("#elementList").on("change",".element_segmentCoords",function(){var id=$(this).closest("li.elementItem").attr("id"),li=$("li#"+id),startX=li.find(".element_segmentStartX").val(),startY=li.find(".element_segmentStartY").val(),endX=li.find(".element_segmentEndX").val(),endY=li.find(".element_segmentEndY").val();PG.els[id].startX=startX,PG.els[id].startY=startY,PG.els[id].endX=endX,PG.els[id].endY=endY,PG.board.removeObject(PG.tmp[id]),PG.buildBoardElement(PG.els[id])}),$("#elementList").on("change",".element_funcDef",function(){var id=$(this).closest("li.elementItem").attr("id"),fd=$(this).val();PG.els[id].funcdef=fd,PG.board.removeObject(PG.tmp[id]),PG.buildBoardElement(PG.els[id]),PG.board.update()}),$("#elementList").on("change",".element_funcLB",function(){var id=$(this).closest("li.elementItem").attr("id");PG.els[id].lowerBound=$(this).val(),PG.board.removeObject(PG.tmp[id]),PG.buildBoardElement(PG.els[id]),PG.board.update()}),$("#elementList").on("change",".element_funcUB",function(){var id=$(this).closest("li.elementItem").attr("id");PG.els[id].upperBound=$(this).val(),PG.board.removeObject(PG.tmp[id]),PG.buildBoardElement(PG.els[id]),PG.board.update()}),$("#elementList").on("change",".element_textX, .element_textY",function(){var id=$(this).closest("li.elementItem").attr("id"),x=$("li#"+id).find(".element_textX").val(),y=$("li#"+id).find(".element_textY").val();PG.els[id].x=x,PG.els[id].y=y,PG.board.removeObject(PG.tmp[id]),PG.buildBoardElement(PG.els[id]),PG.board.update()}),$("#elementList").on("change",".element_text",function(){var id=$(this).closest("li.elementItem").attr("id"),text=$("li#"+id).find(".element_text").val();PG.els[id].text=text,PG.board.removeObject(PG.tmp[id]),PG.buildBoardElement(PG.els[id]),PG.board.update()}),$("#elementList").on("change",".element_circleX, .element_circleY",function(){var id=$(this).closest("li.elementItem").attr("id"),x=$("li#"+id).find(".element_circleX").val(),y=$("li#"+id).find(".element_circleY").val();PG.els[id].x=x,PG.els[id].y=y,PG.board.removeObject(PG.tmp[id]),PG.buildBoardElement(PG.els[id]),PG.board.update()}),$("#elementList").on("change",".element_circleR",function(){var id=$(this).closest("li.elementItem").attr("id"),r=$(this).val();PG.els[id].r=r,PG.board.removeObject(PG.tmp[id]),PG.buildBoardElement(PG.els[id]),PG.board.update()}),$("#elementList").on("input",".element_sizeRange",function(){var id=$(this).closest("li.elementItem").attr("id"),size=$(this).val();PG.els[id].size=size,PG.tmp[id].setAttribute({size:size})}),$("#elementList").on("change",".element_nameInput",function(){var id=$(this).closest("li.elementItem").attr("id"),name=$(this).val();PG.els[id].name=name,PG.tmp[id].setAttribute({name:name})}),$("#elementList").on("change",".element_colorInput",function(){var id=$(this).closest("li.elementItem").attr("id"),color=$(this).val();PG.els[id].color=color,PG.tmp[id].setAttribute({color:color})}),$("#elementList").on("change",".element_strokeColorInput",function(){var id=$(this).closest("li.elementItem").attr("id"),color=$(this).val();PG.els[id].strokeColor=color,PG.tmp[id].setAttribute({strokeColor:color})}),$("#elementList").on("change",".element_fillColorInput",function(){var id=$(this).closest("li.elementItem").attr("id"),color=$(this).val();PG.els[id].fillColor=color,PG.tmp[id].setAttribute({fillColor:color})}),$("#elementList").on("input",".element_fillOpacity",function(){var id=$(this).closest("li.elementItem").attr("id"),opac=$(this).val();PG.els[id].fillOpacity=opac,PG.tmp[id].setAttribute({fillOpacity:parseFloat(opac)}),PG.board.update()}),$("#elementList").on("input",".element_strokeWidth",function(){var id=$(this).closest("li.elementItem").attr("id"),strokeWidth=$(this).val();PG.els[id].strokeWidth=strokeWidth,PG.tmp[id].setAttribute({strokeWidth:strokeWidth})}),$("#elementList").on("input",".element_dash",function(){var id=$(this).closest("li.elementItem").attr("id"),dash=$(this).val();PG.els[id].dash=dash,PG.tmp[id].setAttribute({dash:dash})}),$("#elementList").on("input",".element_arrow",function(){var id=$(this).closest("li.elementItem").attr("id"),arrow=$(this).val();PG.els[id].arrow=arrow,PG.tmp[id].setAttribute({firstArrow:2==arrow||3==arrow,lastArrow:1==arrow||3==arrow})}),$("#elementList").on("input",".element_end",function(){var id=$(this).closest("li.elementItem").attr("id"),end=$(this).val();PG.els[id].end=end,PG.tmp[id].setAttribute({straightFirst:2==end||3==end,straightLast:1==end||3==end})}),$("#elementList").on("change",".element_fontSize",function(){var id=$(this).closest("li.elementItem").attr("id"),fontSize=parseInt($(this).val());PG.els[id].fontSize=fontSize,PG.tmp[id].setAttribute({fontSize:fontSize})})}),PG.initBoard=function(){$("#box").css({width:PG.vars.boardWidth,height:PG.vars.boardHeight}),PG.board=JXG.JSXGraph.initBoard("box",{boundingBox:[PG.vars.bounds[0],PG.vars.bounds[3],PG.vars.bounds[1],PG.vars.bounds[2]],axis:!1,showCopyright:!1,pan:{enabled:!0,needshift:!0},zoom:{factorX:1.25,factorY:1.25,needshift:!0,wheel:!0},showNavigation:!1}),PG.tmp.xaxis=PG.board.create("axis",[[0,0],[1,0]],{strokeColor:"black",strokeWidth:2,highlight:!1,name:PG.vars.xLabel,withLabel:!0,label:{position:"rt",offset:[5,5],highlight:!1,useMathJax:!0,anchorX:"right",anchorY:"bottom"}}),PG.tmp.xaxis.removeAllTicks(),PG.tmp.xAxisTicks=PG.board.create("ticks",[PG.tmp.xaxis],{ticksDistance:PG.vars.ticksDistance[0],strokeColor:"rgba(150,150,150,0.85)",majorHeight:-1,minorHeight:-1,highlight:!1,drawLabels:!0,label:{offset:[0,-5],anchorY:"top",anchorX:"middle",highlight:!1},minorTicks:PG.vars.minorTicks[0]}),PG.tmp.yaxis=PG.board.create("axis",[[0,0],[0,1]],{strokeColor:"black",strokeWidth:2,highlight:!1,name:PG.vars.yLabel,withLabel:!0,label:{display:PG.vars.yLabelVertical?"internal":"html",rotate:PG.vars.yLabelVertical?90:0,position:"rt",offset:[5,5],highlight:!1,useMathJax:!0,anchorX:PG.vars.yLabelVertical?"right":"left",anchorY:"top"}}),PG.tmp.yaxis.removeAllTicks(),PG.tmp.yAxisTicks=PG.board.create("ticks",[PG.tmp.yaxis],{ticksDistance:PG.vars.ticksDistance[1],strokeColor:"rgba(150,150,150,0.85)",majorHeight:-1,minorHeight:-1,highlight:!1,drawLabels:!0,label:{offset:[-5,0],anchorY:"middle",anchorX:"right",highlight:!1},minorTicks:PG.vars.minorTicks[1]})},JXG.Options.layer={numlayers:20,text:9,point:9,glider:9,arc:8,line:7,circle:6,curve:5,turtle:5,polygon:3,sector:3,angle:3,integral:3,axis:3,ticks:2,grid:1,image:0,trace:0},JXG.Options.text.fontSize=PG.vars.globalFontSize;